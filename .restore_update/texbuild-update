UPDATE_FILE=texbuilder.tar.gz
UPDATE_CHECK_FILE=texbuilder.version.txt
UPDATE_URL=http://homepages.dcc.ufmg.br/~rcor/update/
RESTORE_FOLDER=./.restore_update

function usage(){
	echo "Usage: $0 [OPTIONS] DOCNAME"
	exit 0
}

function checkUpdate(){
	wget --quiet $UPDATE_URL/$UPDATE_CHECK_FILE
	if [ -f $UPDATE_CHECK_FILE ]; then
		if ! cmp --quiet $UPDATE_CHECK_FILE version.txt; then
			rm -f $UPDATE_CHECK_FILE
			update
		else
			rm -f $UPDATE_CHECK_FILE
			echo 'TeXbuilder already up to date.'
		fi
	else
		update
	fi
	exit 0
}

function update(){
	wget --quiet $UPDATE_URL/$UPDATE_FILE
	if [ -f $UPDATE_FILE ]; then
		mkdir -p $RESTORE_FOLDER
		rm -f -r $RESTORE_FOLDER/*
		cp -r * $RESTORE_FOLDER/
		rm -f *
		cp $RESTORE_FOLDER/$UPDATE_FILE ./
		#rm -r -f $RESTORE_FOLDER
		tar -xzf $UPDATE_FILE
		chmod 777 *
		rm -f $UPDATE_FILE
	else
		echo 'Could not donwload new TeXbuilder version'
	fi
}

function restoreUpdate(){
	if [ -d $RESTORE_FOLDER ]; then
		rm -f *
		cp $RESTORE_FOLDER/* ./
		rm -f ./$UPDATE_FILE
	else
		echo 'There is no previous TeXbuilder version'
	fi
	exit 0
}

function processArguments(){
	for ARG in $*; do
		if [ "$ARG" == "-v" ]; then
			VERBOSE=true
		elif [ "$ARG" == "--help" ]; then
			usage
		elif [ "$ARG" == "--restore" ]; then
			restoreUpdate
		elif [ "$ARG" == "--update" ]; then
			checkUpdate
		fi
	done
}

function main(){
	if [ $# -eq 0 ]; then
		checkUpdate
	else
		processArguments $*
		startEnvironment
		compile
		finishEnvironment
	fi
}

main $*
